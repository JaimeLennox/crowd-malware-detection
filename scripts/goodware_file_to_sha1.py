import sys

if __name__ == '__main__':
    args = sys.argv[1:]

    if len(args) != 3:
        print "Usage: goodware_file_to_sha1 <sha1_result> <goodware_file> <output_file>"
        sys.exit(2)

    sha1_filename = args[0]
    goodware_filename = args[1]
    output_filename = args[2]

    file2sha1 = {}

    with open(sha1_filename) as sha_results:
        for line in sha_results:
            parts = line.rstrip("\r\n").split("  ")
            sha = parts[0]
            file = parts[1:]

            if len(file) == 1:
                file = file[0]
            else:
                file = "  ".join(file)

            file = file.replace(" ", "")
            if "/" in file:
                file = file.split("/")[1]

            file2sha1[file] = sha

    with open(goodware_filename) as goodware:
        with open(output_filename, 'w') as output:
            for line in goodware:
                parts = line.split(";")
                parts[0] = parts[0].replace(" ", "")
                if "/" in parts[0]:
                    parts[0] = parts[0].split("/")[1]
                if parts[0] in file2sha1:
                    parts[0] = file2sha1[parts[0]]
                else:
                    print parts[0]
                new_line = ";".join(parts)
                output.write(new_line)

