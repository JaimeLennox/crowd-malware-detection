import sys

if __name__ == '__main__':
    args = sys.argv[1:]

    if len(args) != 3:
        print "Usage: convert_goodware <goodware_analyzed_file> <output_engines_file> <output_file>"
        sys.exit(2)

    goodware_analyzed_file = args[0]
    output_engines_file = args[1]
    output_file = args[2]

    with open(goodware_analyzed_file) as goodware_analyzed:
        lines = [line.rstrip(';\r\n') for line in goodware_analyzed]

    data_list = map(lambda x: x.split(';'), lines)

    engines = data_list[0]

    with open(output_engines_file, 'w') as engines_file:
        for engine in engines:
            engines_file.write(engine + "\n")

    data_dict = {}

    for data in data_list[1:]:
        data_dict[data[-1]] = map(int, data[:-1])

    indexes = [engines.index(engine) for engine in engines]

    lines = []

    for data in data_dict:
        line = data + ";"

        for index in indexes:
            line += str(data_dict[data][index]) + ";"

        lines.append(line)

    with open(output_file, 'w') as output:
        for line in lines:
            output.write(line + "\n")
